# Week of September 18

This assignment is due EOD on September 25, 2025.
Requirements: Task 1 AND Task 2 AND Task 3 AND (Task 4 OR Task 5).

## Submission

As you are working, you can [commit and push](https://docs.github.com/en/get-started/using-git/about-git) to your fork. 
To submit the assignment, you will [create a Pull Request](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/creating-a-pull-request-from-a-fork) (PR) with the main [collaborative](https://github.com/ml-feedback-sys/collaborative-f25) repository.
Please title the PR "09-18 Submission - `netID`" and include a description of the work that you did.

Make sure you are keeping your fork [up to date](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/working-with-forks/syncing-a-fork).
Any files that you submit should be in your folder in the collaborative repository (`submission/netID`).

## Task 1: Implement example dynamics

In this assignment, we will implement various state estimation and prediction methods.

You may use the following dynamics, or you may define your own favorite partially observed linear dynamics.

$$ s_{t+1} = \begin{bmatrix} 1 & 0.1 \\\ 0 & 1 \end{bmatrix} s_t + w_t,\quad y_t = \begin{bmatrix} 1 & 0 \end{bmatrix} s_t + v_t $$

The first element of the state can be interpreted as position, which is observed, while the second can be interpreted as the velocity.

Implement this system in code. 
You may want to use an object to keep track of the internal state. 
You may generate process and measurement noise by sampling random variables using `np.random`, you may set their variance to be around 0.1.

Start from a random initial condition and plot the outputs of the system over time for several timesteps.

Is your system stable? 
Is it observable? 
Provide the plot and answers to these questions in your PR.

## Task 2: Implement Kalman filter

Implement the Kalman filter algorithm discussed in lecture.
You may want to use an object to keep track of the estimated state and information matrix.

Starting from a random initial condition, run the system and pass its outputs to the Kalman filter.
Plot the system outputs $y_t$ and the filtered outputs $H\hat s_t$.
Also plot the true system state $s_t$ and the estimated state $\hat s_t$.
Investigate how the information matrix $P_t$ changes over time.
What happens if you increase or decrease the noise?
Provide these plots along with a description of your observations in your PR.

## Task 3: Train an autoregressive model

Now, rather than designing a filter, we will learn a model from data.
First, collect several trajectories from the system. 
Split this data into test and train data. You may want to split the data both by trajectory and by time.
Set up a linear least squares regression problem to predict the output $\hat y_t$ based on the previous $L$ outputs $y_{t-1},\dots,y_{t-L}$.
Investigate the performance of this model on test data.
What happens as you increase or decrease $L$?
Include plots in your PR.

## (pick one) Task 4: Data-driven Kalman filter

Unlike the AR model, the Kalman filter relies on knowing the parameters of the underying dynamical system.
We will derive a data-driven Kalman filter by fitting $\hat F$ and $\hat H$ from training data. 
Then you will evaluate its performance on testing data.
To fit $\hat F$ and $\hat H$, try to following procedure, which is can be understood as an alternating minimization in the spirit of the EM algorithm.
Initialize your model with some random $\hat F_0$ and $\hat H_0$ (you may want to try multiple initializations). 
Then:
1. Run the Kalman filter algorithm with the estimated dynamics to find the sequence of states 
2. Use the estimated states to fit new dynamics matrices with least squares
3. Repeat to convergence
Compare the performance on test data to the AR model.

## (pick one) Task 5: Bounding AR errors

Recall from lecture that the Kalman filter can be understood as a linear state space model: $$ \hat s_{t+1} = \underbrace{(F-L_tHF)}_{F_{L,t}}\hat s_t + L_ty_{t+1},\quad \hat y_t = H\hat s_t $$

For an arbitrary time $t$, you will construct an AR model that $\epsilon$ approximates the KF predictions.
You may use the following facts without proof:
1. The products are bounded for some $C_0>0$ and $0<\rho<1$ $\|\prod_{k=0}^{t-1}F_{L,k}\|_2 \leq C_0\rho^t$
(if you want to justify them thats great too)

How big does $L$ need to be to satisfy $\|\hat y_t^{KF} - \hat y_t^{AR} \|_2 \leq \epsilon$? You should derive a value for $L$ that depends on $\epsilon$, $C_0$, $\rho$, $y_{\max}=\max_{0\leq k\leq t} \|y_t\|_2$, and $\|s_0\|$.